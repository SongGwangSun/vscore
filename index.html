<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>SportScore</title>
    <link rel="stylesheet" href="style.css">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="SportScore">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-orientations" content="portrait">
</head>

<body>
    <!-- ê²Œì„ ì„ íƒ í™”ë©´ -->
    <div id="gameSelection" class="screen">
        <div style="display:flex;align-items:center;gap:0.5rem;width:100%;justify-content:space-between;">
            <h1 style="margin:0;">Sport Score Board</h1>
            <button id="gameMenuBtn" class="control-btn"
                style="width:auto;height:auto;padding:8px 10px;border-radius:10px;" onclick="toggleGameMenu()"
                title="ë©”ë‰´(Menu)">â˜°</button>
        </div>
        <div id="gameMenu"
            style="display:none;position:absolute;top:56px;right:20px;background:#fff;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.12);padding:8px;z-index:1200;">
            <button class="modal-action" style="display:block;width:100%;margin-bottom:6px;"
                onclick="openSavedNamesManager();toggleGameMenu()">ì„ ìˆ˜ ê´€ë¦¬(Players)</button>
            <button class="modal-action" style="display:block;width:100%;margin-bottom:6px;"
                onclick="showHistory();toggleGameMenu()">ê¸°ë¡ ë³´ê¸°(History)</button>
            <button class="modal-action" style="display:block;width:100%;margin-bottom:6px;"
                onclick="voiceLanguage();toggleGameMenu()">ì–¸ì–´ì„¤ì •(Language)</button>
            <button class="modal-action" style="display:block;width:100%;"
                onclick="showAbout();toggleGameMenu()">About</button>
        </div>
        <div class="game-buttons">
            <button class="game-btn" onclick="selectGame('badminton')" type="button">
                <div class="game-icon">ğŸ¸</div>
                <div class="game-name">ë°°ë“œë¯¼í„´<br>Badminton</div>
            </button>
            <button class="game-btn" onclick="selectGame('pingpong')" type="button">
                <div class="game-icon">ğŸ“</div>
                <div class="game-name">íƒêµ¬<br>TableTennis</div>
            </button>
            <button class="game-btn" onclick="selectGame('Jokgu')" type="button">
                <div class="game-icon">ğŸ</div>
                <div class="game-name">ì¡±êµ¬<br>Jokgu</div>
            </button>
            <button class="game-btn" onclick="selectGame('pickleball')" type="button">
                <div class="game-icon">ğŸ¥’</div>
                <div class="game-name">í”¼í´ë³¼<br>PickleBall</div>
            </button>
        </div>
    </div>

    <!-- ê²Œì„ ì„¤ì • í™”ë©´ -->
    <div id="gameSettings" class="screen">
        <div style="display:flex;align-items:center;gap:8px;">
            <button class="control-btn" onclick="showGameSelection()" type="button" title="ì´ì „(Back)"
                style="width:auto;height:auto;padding:6px 8px;border-radius:8px;"> â† </button>
            <h2 id="selectedGameTitle" style="margin:0;">ê²Œì„ ì„¤ì •(Setting)</h2>
        </div>
        <div class="settings-container">
            <div class="setting-group">
                <label for="winScoreRange">ìŠ¹ë¦¬ ì ìˆ˜(WinScore): <span id="winScoreValue">11</span>ì (Point)</label>
                <input type="range" id="winScoreRange" name="winScore" min="1" max="25" value="11"
                    oninput="document.getElementById('winScoreValue').textContent = this.value"
                    aria-label="ìŠ¹ë¦¬ ì ìˆ˜ ì„¤ì •(WInScoreSetting)" />
                <div class="range-labels" aria-hidden="true"
                    style="display:flex;justify-content:space-between;font-size:0.85rem;margin-top:4px;">
                    <span>1</span><span>25</span>
                </div>
            </div>

            <div class="setting-group">
                <label for="totalSetsRange">ì„¸íŠ¸ ìˆ˜(Set): <span id="totalSetsValue">3</span>ì„¸íŠ¸(Set)</label>
                <input type="range" id="totalSetsRange" name="totalSets" min="1" max="7" step="2" value="3"
                    oninput="document.getElementById('totalSetsValue').textContent = this.value"
                    aria-label="ì„¸íŠ¸ ìˆ˜ ì„¤ì •(Set Number Setting)" />
                <div class="range-labels" aria-hidden="true"
                    style="display:flex;justify-content:space-between;font-size:0.85rem;margin-top:4px;">
                    <span>1</span><span>3</span><span>5</span><span>7</span>
                </div>
            </div>

            <div class="setting-group" id="matchTypeGroup" style="display:none;">
                <label>ê²½ê¸° ë°©ì‹(MatchType):</label>
                <div class="radio-group">
                    <input type="radio" id="single" name="matchType" value="single" checked>
                    <label for="single">ë‹¨ì‹-Single</label>
                    <input type="radio" id="double" name="matchType" value="double">
                    <label for="double">ë³µì‹-Double</label>
                </div>
            </div>

            <div class="setting-group">
                <label for="playerReg1">ì„ ìˆ˜ ë“±ë¡(Player Registration):</label>
                <div style="display:flex;gap:0.5rem;flex-wrap:wrap;align-items:center;">
                    <div style="display:flex;align-items:center;gap:6px;">
                        <input type="text" id="playerReg1" class="voice-select" placeholder="ì„ ìˆ˜1 ì´ë¦„ (Player 1 name)"
                            aria-label="Player 1 name" />
                        <button class="control-btn" style="width:auto;height:auto;padding:6px 8px;border-radius:8px;"
                            onclick="openPlayerNamesPicker('playerReg1')">ì„  íƒ</button>
                    </div>
                    <div style="display:flex;align-items:center;gap:6px;">
                        <input type="text" id="playerReg2" class="voice-select" placeholder="ì„ ìˆ˜2 ì´ë¦„ (Player 2 name)"
                            aria-label="Player 2 name" />
                        <button class="control-btn" style="width:auto;height:auto;padding:6px 8px;border-radius:8px;"
                            onclick="openPlayerNamesPicker('playerReg2')">ì„  íƒ</button>
                    </div>
                    <button class="start-btn" style="padding:0.5rem 1rem;" onclick="applyPlayerNames()"
                        type="button">ì ìš©(Apply)</button>
                </div>
            </div>

            <div class="setting-group">
                <label for="setMemoInput">ì„¸íŠ¸ ë©”ëª¨(Memo):</label>
                <input type="text" id="setMemoInput" class="voice-select" placeholder="ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš” (optional)"
                    aria-label="Set memo" />
            </div>

            <div class="setting-group">
                <label>ë™ì˜ìƒ ë…¹í™” ì˜µì…˜(Recording):</label>
                <div style="display:flex;gap:0.5rem;align-items:center;flex-wrap:wrap;">
                    <label style="display:flex;align-items:center;gap:6px;">
                        <input type="checkbox" id="enableRecording" /> ë…¹í™”í•˜ê¸°(Enable recording)
                    </label>
                    <label style="display:flex;align-items:center;gap:6px;align-items:center;">
                        í™”ì§ˆ(Quality):
                        <select id="recordQuality" style="padding:0.35rem;border-radius:6px;border:1px solid #e6e6e6;">
                            <option value="medium">ì¤‘ê°„(Medium)</option>
                            <option value="low">ë‚®ìŒ(Low)</option>
                            <option value="high">ë†’ìŒ(High)</option>
                        </select>
                    </label>
                    <label id="facingLabel" style="display:flex;align-items:center;gap:6px;">
                        ì¹´ë©”ë¼ ì„ íƒ(Camera):
                        <select id="cameraFacing" style="padding:0.35rem;border-radius:6px;border:1px solid #e6e6e6;">
                            <option value="user">ì „ë©´(Front)</option>
                            <option value="environment">í›„ë©´(Back)</option>
                        </select>
                    </label>
                    <label id="deviceLabel" style="display:none;align-items:center;gap:6px;">
                        ì¥ì¹˜(Device):
                        <select id="cameraDevice" style="padding:0.35rem;border-radius:6px;border:1px solid #e6e6e6;"></select>
                    </label>
                    <div style="color:#666;font-size:0.85rem;">ì¹´ë©”ë¼ ì ‘ê·¼ ê¶Œí•œì´ ìš”ì²­ë©ë‹ˆë‹¤. (íœ´ëŒ€í°ì€ ì „ë©´/í›„ë©´ ì„ íƒ ê°€ëŠ¥)</div>
                </div>
            </div>

            <button class="start-btn" onclick="startGame()" type="button">ê²Œì„ ì‹œì‘(Start Game)</button>
        </div>
    </div>

    <!-- ì ìˆ˜íŒ í™”ë©´ -->
    <div id="scoreboard" class="screen">
        <!-- í•˜ë‹¨ ë²„íŠ¼ë“¤ -->
        <div class="control-buttons">
            <button class="control-btn" onclick="showGameSelection()" type="button" title="ìƒˆ ê²Œì„(New game)">ğŸ </button>
            <button class="control-btn" onclick="resetSet()" type="button" title="ì„¸íŠ¸ ë¦¬ì…‹(Set reset)">ğŸ”„</button>
            <button class="control-btn" onclick="undoLastScore()" type="button" title="ì‹¤ìˆ˜ ìˆ˜ì •(Score undo)">â†©ï¸</button>
            <button class="control-btn" onclick="switchCourt()" type="button" title="ì½”íŠ¸ êµì²´(Change court)">ğŸ”ƒ</button>
            <button class="control-btn" onclick="showHistory()" type="button" title="History">ğŸ“œ</button>
            <button class="control-btn" onclick="showAbout()" type="button" title="About">â„¹ï¸</button>
        </div>
        <div class="scoreboard-container">
            <div class="player-score" id="player1Score" role="button" tabindex="0" aria-label="Player 1 Score">
                <div class="player-name">Player 1 - <span id="player1SetsInline">0</span></div>
                <div class="score-display" id="score1">0</div>
            </div>
        </div>

        <div class="scoreboard-container">
            <div class="player-score" id="player2Score" role="button" tabindex="0" aria-label="Player 2 Score">
                <div class="player-name">Player 2 - <span id="player2SetsInline">0</span></div>
                <div class="score-display" id="score2">0</div>
            </div>
        </div>

    </div>

    <!-- Voice Language í™”ë©´ -->
    <div id="voiceLanguage" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closevoiceLanguage()" aria-label="ë‹«ê¸°(Close)">&times;</button>
            <h2>ìŒì„± ì–¸ì–´(Voice)</h2>
            <div class="voice-display">
                <label for="voiceLangSelect">ìŒì„± ì–¸ì–´ ì„ íƒ(Voice) :</label>
                <select id="voiceLangSelect" class="voice-select" aria-label="ìŒì„± ì–¸ì–´ ì„ íƒ(Speech Language)">
                    <option value="ko-KR">í•œêµ­ì–´ (í•œêµ­ì–´)</option>
                    <option value="en-US">English (US)</option>
                </select>
            </div>
            <div class="modal-footer">
                <button class="modal-action" onclick="closevoiceLanguage()">í™•ì¸(OK)</button>
            </div>
        </div>
    </div>

    <!-- ê²Œì„ ì¢…ë£Œ í™”ë©´ -->
    <div id="gameEnd" class="screen">
        <h2>ê²Œì„ ì¢…ë£Œ - Game over!</h2>
        <div class="winner-display">
            <div class="winner-text" id="winnerText">ìŠ¹ì(Winner): Player 1</div>
            <div style="font-size:0.95rem;color:#666;margin:0.5rem 0;">
                <span id="player1DisplayName">Player 1</span> <span id="finalScore">3</span> - <span
                    id="finalScore2">2</span> <span id="player2DisplayName">Player 2</span>
            </div>
            <div class="final-score" id="finalScoreSets">3 - 2 ì„¸íŠ¸(Sets)</div>
        </div>
        <div class="end-buttons">
            <button class="end-btn" onclick="showGameSelection()" type="button">ì²˜ìŒìœ¼ë¡œ(Home)</button>
            <button class="end-btn" onclick="showGameSettings()" type="button">ìƒˆ ê²Œì„(New game)</button>
            <button class="end-btn" onclick="startGame()" type="button">ê°™ì€ ì„¤ì •ìœ¼ë¡œ ì¬ì‹œì‘(Restart)</button>
        </div>
    </div>

    <!-- About ëª¨ë‹¬ -->
    <div id="aboutModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeAboutModal()" aria-label="ë‹«ê¸°(Close)">&times;</button>
            <h2>SportScore</h2>
            <p>ë²„ì „(Version): <strong>v1.0</strong></p>
            <p>ì œì‘(creation): <strong>sun2soft</strong></p>
            <p>ë¬¸ì˜(Inquiry): <a href="mailto:songgs33@gmail.com">songgs33@gmail.com</a></p>
            <div class="modal-footer">
                <button class="modal-action" onclick="closeAboutModal()">í™•ì¸(OK)</button>
            </div>
        </div>
    </div>

    <!-- History ëª¨ë‹¬ -->
    <div id="historyModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeHistoryModal()" aria-label="ë‹«ê¸°(Close)">&times;</button>
            <h2>ê²½ê¸° ê¸°ë¡(History)</h2>
            <div style="display:flex;gap:0.5rem;margin:0.5rem 0 0.75rem 0;flex-wrap:wrap;align-items:center;">
                <input type="date" id="historyFilterDate"
                    style="padding:0.5rem;border-radius:6px;border:1px solid #e6e6e6;" />
                <input type="text" id="historyFilterPlayer" placeholder="ì„ ìˆ˜ ì´ë¦„(Player)"
                    style="padding:0.5rem;border-radius:6px;border:1px solid #e6e6e6;min-width:140px;" />
                <select id="historyFilterGame"
                    style="padding:0.5rem;border-radius:6px;border:1px solid #e6e6e6;min-width:140px;">
                    <option value="">ê²½ê¸°ëª… ì„ íƒ(Select Game)</option>
                    <option value="ë°°ë“œë¯¼í„´">ë°°ë“œë¯¼í„´</option>
                    <option value="íƒêµ¬">íƒêµ¬</option>
                    <option value="ì¡±êµ¬">ì¡±êµ¬</option>
                    <option value="í”¼í´ë³¼">í”¼í´ë³¼</option>
                </select>
                <button class="modal-action" onclick="applyHistoryFilters()">í•„í„°(Filter)</button>
                <button class="modal-action" onclick="clearHistoryFilters()">ì´ˆê¸°í™”(Clear)</button>
            </div>
            <div id="historyList"
                style="max-height:48vh;overflow:auto;text-align:left;margin-top:0.5rem;padding:0.5rem;"></div>
            <div class="modal-footer"
                style="display:flex;gap:0.5rem;justify-content:center;align-items:center;margin-top:1rem;">
                <button class="modal-action" onclick="clearHistory()">ì‚­ì œ(Clear)</button>
                <button class="modal-action" onclick="exportHistory()">ë‚´ë³´ë‚´ê¸°(Export)</button>
                <button class="modal-action" onclick="closeHistoryModal()">ë‹«ê¸°(Close)</button>
            </div>
        </div>
    </div>

    <!-- Saved Names Manager Modal -->
    <div id="savedNamesModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeSavedNamesManager()" aria-label="ë‹«ê¸°(Close)">&times;</button>
            <h2>ì„ ìˆ˜ ëª©ë¡(Manage Players)</h2>
            <div style="display:flex;gap:0.5rem;margin:0.5rem 0 0.5rem 0;align-items:center;">
                <input type="text" id="newSavedName" placeholder="ì´ë¦„ ì…ë ¥(Add name)"
                    style="flex:1;padding:0.5rem;border-radius:6px;border:1px solid #e6e6e6;" />
                <button class="modal-action" onclick="addNewSavedName()">ì¶”ê°€(Add)</button>
            </div>
            <div id="savedNamesList" style="max-height:50vh;overflow:auto;margin-top:0.5rem;padding:0.25rem;"></div>
            <div class="modal-footer"
                style="display:flex;gap:0.5rem;justify-content:center;align-items:center;margin-top:1rem;">
                <button class="modal-action" onclick="closeSavedNamesManager()">ë‹«ê¸°(Close)</button>
            </div>
        </div>
    </div>

    <!-- History Detail Modal -->
    <div id="historyDetailModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeHistoryDetail()" aria-label="ë‹«ê¸°(Close)">&times;</button>
            <h2>ê¸°ë¡ ìƒì„¸(Detail)</h2>
            <div style="display:flex;flex-direction:column;gap:0.5rem;">
                <div><label>ì¼ì(Date): </label><input id="detailDate" readonly
                        style="padding:0.4rem;border-radius:6px;border:1px solid #e6e6e6;" /></div>
                <div><label>ì‹œê°„(Time): </label><input id="detailTime"
                        style="padding:0.4rem;border-radius:6px;border:1px solid #e6e6e6;" /></div>
                <div><label>ê²½ê¸°(Game): </label><input id="detailGame"
                        style="padding:0.4rem;border-radius:6px;border:1px solid #e6e6e6;" /></div>
                <div style="display:flex;gap:0.5rem;"><input id="detailP1"
                        style="flex:1;padding:0.4rem;border-radius:6px;border:1px solid #e6e6e6;" /><input id="detailS1"
                        style="width:80px;padding:0.4rem;border-radius:6px;border:1px solid #e6e6e6;" /></div>
                <div style="display:flex;gap:0.5rem;"><input id="detailP2"
                        style="flex:1;padding:0.4rem;border-radius:6px;border:1px solid #e6e6e6;" /><input id="detailS2"
                        style="width:80px;padding:0.4rem;border-radius:6px;border:1px solid #e6e6e6;" /></div>
                <div><label>ì„¸íŠ¸ ë²ˆí˜¸(Set): </label><input id="detailSet" type="number" min="1"
                        style="width:80px;padding:0.4rem;border-radius:6px;border:1px solid #e6e6e6;" /></div>
                <div><label>ë©”ëª¨(Memo): </label><input id="detailMemo"
                        style="padding:0.4rem;border-radius:6px;border:1px solid #e6e6e6;" /></div>
                <div id="detailVideoContainer" style="display:block;margin-top:0.5rem;">
                    <label>ë…¹í™” ì˜ìƒ(Video): </label>
                    <div style="display:flex;flex-direction:column;gap:0.25rem;margin-top:0.25rem;">
                        <video id="detailVideo" controls style="max-width:100%;display:none;background:#000;border-radius:6px;-webkit-user-select:none;user-select:none;"></video>
                        <div id="detailVideoName" style="font-size:0.85rem;color:#444;"></div>
                        <div id="detailVideoDownloadBtn" style="display:none;">
                            <button class="modal-action" onclick="downloadDetailVideo()" style="width:100%;margin-top:0.25rem;">ë‹¤ìš´ë¡œë“œ(Download)</button>
                            <div style="font-size:0.75rem;color:#999;margin-top:0.2rem;text-align:center;">iOS: ê¸¸ê²Œ ëˆŒëŸ¬ì„œ ì €ì¥(Long-press to save)</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer"
                style="display:flex;gap:0.5rem;justify-content:center;align-items:center;margin-top:1rem;">
                <button class="modal-action" onclick="saveHistoryDetail()">ì €ì¥(Save)</button>
                <button class="modal-action" onclick="deleteHistoryDetail()">ì‚­ì œ(Delete)</button>
                <button class="modal-action" onclick="closeHistoryDetail()">ë‹«ê¸°(Close)</button>
            </div>
        </div>
    </div>

    <!-- Player Names Picker Modal (Listbox) -->
    <div id="playerNamesPickerModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closePlayerNamesPicker()" aria-label="ë‹«ê¸°(Close)">&times;</button>
            <h2>ì„ ìˆ˜ ì„ íƒ(Select Player)</h2>
            <div id="playerNamesList"
                style="max-height:50vh;overflow:auto;margin-top:0.5rem;padding:0.25rem;border:1px solid #e6e6e6;border-radius:6px;background:#fafafa;">
            </div>
            <div class="modal-footer"
                style="display:flex;gap:0.5rem;justify-content:center;align-items:center;margin-top:1rem;">
                <button class="modal-action" onclick="closePlayerNamesPicker()">ë‹«ê¸°(Close)</button>
            </div>
        </div>
    </div>

    <!-- Recording Progress Modal -->
    <div id="recordingProgressModal" class="modal">
        <div class="modal-content" style="max-width:300px;text-align:center;">
            <h3 style="margin-top:0;">ë™ì˜ìƒ ë³€í™˜ ì¤‘(Converting...)</h3>
            <div style="margin:1.5rem 0;">
                <div style="width:100%;background:#e0e0e0;border-radius:10px;overflow:hidden;height:20px;">
                    <div id="conversionProgressBar" style="width:0%;background:linear-gradient(90deg,#667eea,#764ba2);height:100%;transition:width 0.3s;"></div>
                </div>
                <div id="conversionProgressText" style="margin-top:0.5rem;font-size:0.9rem;color:#666;">0%</div>
            </div>
            <div style="font-size:0.85rem;color:#999;">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</div>
        </div>
    </div>

    <!-- Save Confirmation Modal -->
    <div id="saveConfirmModal" class="modal">
        <div class="modal-content" style="max-width:320px;">
            <h3 style="margin-top:0;">ë™ì˜ìƒ ì €ì¥ ì™„ë£Œ(Save Complete)</h3>
            <div style="margin:1rem 0;padding:1rem;background:#f0f8ff;border-radius:8px;border-left:4px solid #667eea;">
                <div style="font-size:0.9rem;color:#333;margin-bottom:0.5rem;" id="saveConfirmFilename"></div>
                <div style="font-size:0.8rem;color:#666;">ì•„ì´í°: íŒŒì¼ ì•±ì—ì„œ í™•ì¸í•˜ê±°ë‚˜<br/>AirDropìœ¼ë¡œ ë‹¤ë¥¸ ê¸°ê¸°ì— ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
            </div>
            <div class="modal-footer" style="display:flex;gap:0.5rem;justify-content:center;margin-top:1rem;">
                <button class="modal-action" onclick="closeSaveConfirm()">í™•ì¸(OK)</button>
            </div>
        </div>
    </div>

    <script async src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.12.6/dist/ffmpeg.min.js"></script>
    <script src="script.js"></script>
</body>

</html>
</body>

</html>