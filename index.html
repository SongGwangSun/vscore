<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>SportScore</title>
    <link rel="stylesheet" href="style.css">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="SportScore">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-orientations" content="landscape">
</head>

<body>
    <div id="gameMenu" class="global-menu">
        <button class="modal-action" style="display:block;width:100%;margin-bottom:6px;"
            onclick="openSavedNamesManager();closeGameMenu()">선수 관리(Players)</button>
        <button class="modal-action" style="display:block;width:100%;margin-bottom:6px;"
            onclick="showHistory();closeGameMenu()">기록 보기(History)</button>
        <button class="modal-action" style="display:block;width:100%;margin-bottom:6px;"
            onclick="voiceLanguage();closeGameMenu()">언어설정(Language)</button>
        <button class="modal-action" style="display:block;width:100%;"
            onclick="showAbout();closeGameMenu()">About</button>
    </div>

    <div id="orientationWarning" class="orientation-warning">
        가로 모드를 유지해주세요.<br />기기를 회전해도 화면이 자동으로 회전하지 않습니다.
    </div>

    <!-- 게임 선택 화면 -->
    <div id="gameSelection" class="screen">
        <div style="display:flex;align-items:center;gap:0.5rem;width:100%;justify-content:space-between;">
            <h1 style="margin:0;">Sport Score Board</h1>
            <button id="gameMenuBtn" class="control-btn"
                style="width:auto;height:auto;padding:8px 10px;border-radius:10px;" onclick="toggleGameMenu(event)"
                title="메뉴(Menu)">☰</button>
        </div>
        <div class="game-buttons">
            <button class="game-btn" onclick="selectGame('badminton')" type="button">
                <div class="game-icon">🏸</div>
                <div class="game-name">배드민턴<br>Badminton</div>
            </button>
            <button class="game-btn" onclick="selectGame('pingpong')" type="button">
                <div class="game-icon">🏓</div>
                <div class="game-name">탁구<br>TableTennis</div>
            </button>
            <button class="game-btn" onclick="selectGame('Jokgu')" type="button">
                <div class="game-icon">🏐</div>
                <div class="game-name">족구<br>Jokgu</div>
            </button>
            <button class="game-btn" onclick="selectGame('pickleball')" type="button">
                <div class="game-icon">🥒</div>
                <div class="game-name">피클볼<br>PickleBall</div>
            </button>
        </div>
    </div>

    <!-- 게임 설정 화면 -->
    <div id="gameSettings" class="screen">
        <div style="display:flex;align-items:center;gap:8px;">
            <button class="control-btn" onclick="showGameSelection()" type="button" title="이전(Back)"
                style="width:auto;height:auto;padding:6px 8px;border-radius:8px;"> ← </button>
            <h2 id="selectedGameTitle" style="margin:0;">게임 설정(Setting)</h2>
        </div>
        <div class="settings-container">
            <div class="setting-group">
                <label for="winScoreRange">승리 점수(WinScore): <span id="winScoreValue">11</span>점(Point)</label>
                <input type="range" id="winScoreRange" name="winScore" min="1" max="25" value="11"
                    oninput="document.getElementById('winScoreValue').textContent = this.value"
                    aria-label="승리 점수 설정(WInScoreSetting)" />
                <div class="range-labels" aria-hidden="true"
                    style="display:flex;justify-content:space-between;font-size:0.85rem;margin-top:4px;">
                    <span>1</span><span>25</span>
                </div>
            </div>

            <div class="setting-group">
                <label for="totalSetsRange">세트 수(Set): <span id="totalSetsValue">3</span>세트(Set)</label>
                <input type="range" id="totalSetsRange" name="totalSets" min="1" max="7" step="2" value="3"
                    oninput="document.getElementById('totalSetsValue').textContent = this.value"
                    aria-label="세트 수 설정(Set Number Setting)" />
                <div class="range-labels" aria-hidden="true"
                    style="display:flex;justify-content:space-between;font-size:0.85rem;margin-top:4px;">
                    <span>1</span><span>3</span><span>5</span><span>7</span>
                </div>
            </div>

            <div class="setting-group" id="matchTypeGroup" style="display:none;">
                <label>경기 방식(MatchType):</label>
                <div class="radio-group">
                    <input type="radio" id="single" name="matchType" value="single" checked>
                    <label for="single">단식-Single</label>
                    <input type="radio" id="double" name="matchType" value="double">
                    <label for="double">복식-Double</label>
                </div>
            </div>

            <div class="setting-group">
                <label for="playerReg1">선수 등록(Player Registration):</label>
                <div style="display:flex;gap:0.5rem;flex-wrap:wrap;align-items:center;">
                    <div style="display:flex;align-items:center;gap:6px;">
                        <input type="text" id="playerReg1" class="voice-select" placeholder="선수1 이름 (Player 1 name)"
                            aria-label="Player 1 name" />
                        <button class="control-btn" style="width:auto;height:auto;padding:6px 8px;border-radius:8px;"
                            onclick="openPlayerNamesPicker('playerReg1')">선 택</button>
                    </div>
                    <div style="display:flex;align-items:center;gap:6px;">
                        <input type="text" id="playerReg2" class="voice-select" placeholder="선수2 이름 (Player 2 name)"
                            aria-label="Player 2 name" />
                        <button class="control-btn" style="width:auto;height:auto;padding:6px 8px;border-radius:8px;"
                            onclick="openPlayerNamesPicker('playerReg2')">선 택</button>
                    </div>
                    <button class="start-btn" style="padding:0.5rem 1rem;" onclick="applyPlayerNames()"
                        type="button">적용(Apply)</button>
                </div>
            </div>

            <div class="setting-group">
                <label for="setMemoInput">세트 메모(Memo):</label>
                <input type="text" id="setMemoInput" class="voice-select" placeholder="메모를 입력하세요 (optional)"
                    aria-label="Set memo" />
            </div>

            <div class="setting-group">
                <label>동영상 녹화 옵션(Recording):</label>
                <div style="display:flex;gap:0.5rem;align-items:center;flex-wrap:wrap;">
                    <label style="display:flex;align-items:center;gap:6px;">
                        <input type="checkbox" id="enableRecording" /> 녹화하기(Enable recording)
                    </label>
                    <label style="display:flex;align-items:center;gap:6px;align-items:center;">
                        화질(Quality):
                        <select id="recordQuality" style="padding:0.35rem;border-radius:6px;border:1px solid #e6e6e6;">
                            <option value="medium">중간(Medium)</option>
                            <option value="low">낮음(Low)</option>
                            <option value="high">높음(High)</option>
                        </select>
                    </label>
                    <label id="facingLabel" style="display:flex;align-items:center;gap:6px;">
                        카메라 선택(Camera):
                        <select id="cameraFacing" style="padding:0.35rem;border-radius:6px;border:1px solid #e6e6e6;">
                            <option value="user">전면(Front)</option>
                            <option value="environment">후면(Back)</option>
                        </select>
                    </label>
                    <label id="deviceLabel" style="display:none;align-items:center;gap:6px;">
                        장치(Device):
                        <select id="cameraDevice" style="padding:0.35rem;border-radius:6px;border:1px solid #e6e6e6;"></select>
                    </label>
                    <div style="color:#666;font-size:0.85rem;">카메라 접근 권한이 요청됩니다. (휴대폰은 전면/후면 선택 가능)</div>
                </div>
            </div>

            <button class="start-btn" onclick="startGame()" type="button">게임 시작(Start Game)</button>
        </div>
    </div>

    <!-- 점수판 화면 -->
    <div id="scoreboard" class="screen scoreboard-modern">
        <div class="scoreboard-header">
            <div class="header-left">
                <div class="header-game-info">
                    <span class="header-label">경기</span>
                    <strong id="liveGameName">게임 대기</strong>
                </div>
                <button id="gamePauseBtn" class="pause-btn" onclick="toggleGamePause()" type="button"
                    title="경기 일시 정지(Pause Game)">Ⅱ</button>
                <div class="header-times">
                    <div class="time-block">
                        <span class="time-label">현재시간</span>
                        <strong id="currentTimeDisplay">--:--</strong>
                    </div>
                    <div class="time-block">
                        <span class="time-label">경과시간</span>
                        <strong id="elapsedTimeDisplay">00:00</strong>
                    </div>
                </div>
            </div>
            <div class="header-center">
                <div class="team-name" id="team1HeaderName">Player 1</div>
                <div class="set-score-display" id="setScoreHeader">0 : 0</div>
                <div class="team-name" id="team2HeaderName">Player 2</div>
            </div>
            <button class="menu-icon-btn" onclick="toggleGameMenu(event)" type="button" title="메뉴(Menu)">☰</button>
        </div>

        <div class="scoreboard-body">
            <div class="score-card team1 player-score" id="player1Score" role="button" tabindex="0"
                aria-label="Player 1 Score">
                <div class="team-label" id="team1Label">Player 1</div>
                <div class="score-display" id="score1">0</div>
                <div class="set-indicator">세트 승리: <span id="player1SetsInline">0</span></div>
            </div>
            <div class="score-divider">
                <div class="vs-text">VS</div>
                <div class="serve-indicator" id="serveIndicator">Serve</div>
            </div>
            <div class="score-card team2 player-score" id="player2Score" role="button" tabindex="0"
                aria-label="Player 2 Score">
                <div class="team-label" id="team2Label">Player 2</div>
                <div class="score-display" id="score2">0</div>
                <div class="set-indicator">세트 승리: <span id="player2SetsInline">0</span></div>
            </div>
        </div>

        <div class="control-buttons">
            <button class="control-btn" onclick="showGameSelection()" type="button" title="새 게임(New game)">🏠</button>
            <button class="control-btn" onclick="resetSet()" type="button" title="세트 리셋(Set reset)">🔄</button>
            <button class="control-btn" onclick="undoLastScore()" type="button" title="실수 수정(Score undo)">↩️</button>
            <button class="control-btn" onclick="switchCourt()" type="button" title="코트 교체(Change court)">🔃</button>
            <button id="pauseRecordingBtn" class="control-btn" onclick="toggleRecordingPause()" type="button"
                style="display:none;" title="녹화 일시 정지(Pause Recording)">⏸️</button>
            <button class="control-btn" onclick="showHistory()" type="button" title="History">📜</button>
            <button class="control-btn" onclick="showAbout()" type="button" title="About">ℹ️</button>
        </div>
    </div>

    <!-- Voice Language 화면 -->
    <div id="voiceLanguage" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closevoiceLanguage()" aria-label="닫기(Close)">&times;</button>
            <h2>음성 언어(Voice)</h2>
            <div class="voice-display">
                <label for="voiceLangSelect">음성 언어 선택(Voice) :</label>
                <select id="voiceLangSelect" class="voice-select" aria-label="음성 언어 선택(Speech Language)">
                    <option value="ko-KR">한국어 (한국어)</option>
                    <option value="en-US">English (US)</option>
                </select>
            </div>
            <div class="modal-footer">
                <button class="modal-action" onclick="closevoiceLanguage()">확인(OK)</button>
            </div>
        </div>
    </div>

    <!-- 게임 종료 화면 -->
    <div id="gameEnd" class="screen">
        <h2>게임 종료 - Game over!</h2>
        <div class="winner-display">
            <div class="winner-text" id="winnerText">승자(Winner): Player 1</div>
            <div style="font-size:0.95rem;color:#666;margin:0.5rem 0;">
                <span id="player1DisplayName">Player 1</span> <span id="finalScore">3</span> - <span
                    id="finalScore2">2</span> <span id="player2DisplayName">Player 2</span>
            </div>
            <div class="final-score" id="finalScoreSets">3 - 2 세트(Sets)</div>
        </div>
        <div class="end-buttons">
            <button class="end-btn" onclick="showGameSelection()" type="button">처음으로(Home)</button>
            <button class="end-btn" onclick="showGameSettings()" type="button">새 게임(New game)</button>
            <button class="end-btn" onclick="startGame()" type="button">같은 설정으로 재시작(Restart)</button>
        </div>
    </div>

    <!-- About 모달 -->
    <div id="aboutModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeAboutModal()" aria-label="닫기(Close)">&times;</button>
            <h2>SportScore</h2>
            <p>버전(Version): <strong>v1.0</strong></p>
            <p>제작(creation): <strong>sun2soft</strong></p>
            <p>문의(Inquiry): <a href="mailto:songgs33@gmail.com">songgs33@gmail.com</a></p>
            <div class="modal-footer">
                <button class="modal-action" onclick="closeAboutModal()">확인(OK)</button>
            </div>
        </div>
    </div>

    <!-- History 모달 -->
    <div id="historyModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeHistoryModal()" aria-label="닫기(Close)">&times;</button>
            <h2>경기 기록(History)</h2>
            <div style="display:flex;gap:0.5rem;margin:0.5rem 0 0.75rem 0;flex-wrap:wrap;align-items:center;">
                <input type="date" id="historyFilterDate"
                    style="padding:0.5rem;border-radius:6px;border:1px solid #e6e6e6;" />
                <input type="text" id="historyFilterPlayer" placeholder="선수 이름(Player)"
                    style="padding:0.5rem;border-radius:6px;border:1px solid #e6e6e6;min-width:140px;" />
                <select id="historyFilterGame"
                    style="padding:0.5rem;border-radius:6px;border:1px solid #e6e6e6;min-width:140px;">
                    <option value="">경기명 선택(Select Game)</option>
                    <option value="배드민턴">배드민턴</option>
                    <option value="탁구">탁구</option>
                    <option value="족구">족구</option>
                    <option value="피클볼">피클볼</option>
                </select>
                <button class="modal-action" onclick="applyHistoryFilters()">필터(Filter)</button>
                <button class="modal-action" onclick="clearHistoryFilters()">초기화(Clear)</button>
            </div>
            <div id="historyList"
                style="max-height:48vh;overflow:auto;text-align:left;margin-top:0.5rem;padding:0.5rem;"></div>
            <div class="modal-footer"
                style="display:flex;gap:0.5rem;justify-content:center;align-items:center;margin-top:1rem;">
                <button class="modal-action" onclick="clearHistory()">삭제(Clear)</button>
                <button class="modal-action" onclick="exportHistory()">내보내기(Export)</button>
                <button class="modal-action" onclick="closeHistoryModal()">닫기(Close)</button>
            </div>
        </div>
    </div>

    <!-- Saved Names Manager Modal -->
    <div id="savedNamesModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeSavedNamesManager()" aria-label="닫기(Close)">&times;</button>
            <h2>선수 목록(Manage Players)</h2>
            <div style="display:flex;gap:0.5rem;margin:0.5rem 0 0.5rem 0;align-items:center;">
                <input type="text" id="newSavedName" placeholder="이름 입력(Add name)"
                    style="flex:1;padding:0.5rem;border-radius:6px;border:1px solid #e6e6e6;" />
                <button class="modal-action" onclick="addNewSavedName()">추가(Add)</button>
            </div>
            <div id="savedNamesList" style="max-height:50vh;overflow:auto;margin-top:0.5rem;padding:0.25rem;"></div>
            <div class="modal-footer"
                style="display:flex;gap:0.5rem;justify-content:center;align-items:center;margin-top:1rem;">
                <button class="modal-action" onclick="closeSavedNamesManager()">닫기(Close)</button>
            </div>
        </div>
    </div>

    <!-- History Detail Modal -->
    <div id="historyDetailModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeHistoryDetail()" aria-label="닫기(Close)">&times;</button>
            <h2>기록 상세(Detail)</h2>
            <div style="display:flex;flex-direction:column;gap:0.5rem;">
                <div><label>일자(Date): </label><input id="detailDate" readonly
                        style="padding:0.4rem;border-radius:6px;border:1px solid #e6e6e6;" /></div>
                <div><label>시간(Time): </label><input id="detailTime"
                        style="padding:0.4rem;border-radius:6px;border:1px solid #e6e6e6;" /></div>
                <div><label>경기(Game): </label><input id="detailGame"
                        style="padding:0.4rem;border-radius:6px;border:1px solid #e6e6e6;" /></div>
                <div style="display:flex;gap:0.5rem;"><input id="detailP1"
                        style="flex:1;padding:0.4rem;border-radius:6px;border:1px solid #e6e6e6;" /><input id="detailS1"
                        style="width:80px;padding:0.4rem;border-radius:6px;border:1px solid #e6e6e6;" /></div>
                <div style="display:flex;gap:0.5rem;"><input id="detailP2"
                        style="flex:1;padding:0.4rem;border-radius:6px;border:1px solid #e6e6e6;" /><input id="detailS2"
                        style="width:80px;padding:0.4rem;border-radius:6px;border:1px solid #e6e6e6;" /></div>
                <div><label>세트 번호(Set): </label><input id="detailSet" type="number" min="1"
                        style="width:80px;padding:0.4rem;border-radius:6px;border:1px solid #e6e6e6;" /></div>
                <div><label>메모(Memo): </label><input id="detailMemo"
                        style="padding:0.4rem;border-radius:6px;border:1px solid #e6e6e6;" /></div>
                <div id="detailVideoContainer" style="display:block;margin-top:0.5rem;">
                    <label>녹화 영상(Video): </label>
                    <div style="display:flex;flex-direction:column;gap:0.25rem;margin-top:0.25rem;">
                        <video id="detailVideo" controls style="max-width:100%;display:none;background:#000;border-radius:6px;-webkit-user-select:none;user-select:none;"></video>
                        <div id="detailVideoName" style="font-size:0.85rem;color:#444;"></div>
                        <div id="detailVideoDownloadBtn" style="display:none;">
                            <button class="modal-action" onclick="downloadDetailVideo()" style="width:100%;margin-top:0.25rem;">다운로드(Download)</button>
                            <div style="font-size:0.75rem;color:#999;margin-top:0.2rem;text-align:center;">iOS: 길게 눌러서 저장(Long-press to save)</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer"
                style="display:flex;gap:0.5rem;justify-content:center;align-items:center;margin-top:1rem;">
                <button class="modal-action" onclick="saveHistoryDetail()">저장(Save)</button>
                <button class="modal-action" onclick="deleteHistoryDetail()">삭제(Delete)</button>
                <button class="modal-action" onclick="closeHistoryDetail()">닫기(Close)</button>
            </div>
        </div>
    </div>

    <!-- Player Names Picker Modal (Listbox) -->
    <div id="playerNamesPickerModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closePlayerNamesPicker()" aria-label="닫기(Close)">&times;</button>
            <h2>선수 선택(Select Player)</h2>
            <div id="playerNamesList"
                style="max-height:50vh;overflow:auto;margin-top:0.5rem;padding:0.25rem;border:1px solid #e6e6e6;border-radius:6px;background:#fafafa;">
            </div>
            <div class="modal-footer"
                style="display:flex;gap:0.5rem;justify-content:center;align-items:center;margin-top:1rem;">
                <button class="modal-action" onclick="closePlayerNamesPicker()">닫기(Close)</button>
            </div>
        </div>
    </div>

    <!-- Recording Progress Modal -->
    <div id="recordingProgressModal" class="modal">
        <div class="modal-content" style="max-width:300px;text-align:center;">
            <h3 style="margin-top:0;">동영상 변환 중(Converting...)</h3>
            <div style="margin:1.5rem 0;">
                <div style="width:100%;background:#e0e0e0;border-radius:10px;overflow:hidden;height:20px;">
                    <div id="conversionProgressBar" style="width:0%;background:linear-gradient(90deg,#667eea,#764ba2);height:100%;transition:width 0.3s;"></div>
                </div>
                <div id="conversionProgressText" style="margin-top:0.5rem;font-size:0.9rem;color:#666;">0%</div>
            </div>
            <div style="font-size:0.85rem;color:#999;">잠시만 기다려주세요...</div>
        </div>
    </div>

    <!-- Save Confirmation Modal -->
    <div id="saveConfirmModal" class="modal">
        <div class="modal-content" style="max-width:320px;">
            <h3 style="margin-top:0;">동영상 저장 완료(Save Complete)</h3>
            <div style="margin:1rem 0;padding:1rem;background:#f0f8ff;border-radius:8px;border-left:4px solid #667eea;">
                <div style="font-size:0.9rem;color:#333;margin-bottom:0.5rem;" id="saveConfirmFilename"></div>
                <div style="font-size:0.8rem;color:#666;">아이폰: 파일 앱에서 확인하거나<br/>AirDrop으로 다른 기기에 보낼 수 있습니다.</div>
            </div>
            <div class="modal-footer" style="display:flex;gap:0.5rem;justify-content:center;margin-top:1rem;">
                <button class="modal-action" onclick="closeSaveConfirm()">확인(OK)</button>
            </div>
        </div>
    </div>

    <!-- Recording Preview Modal -->
    <div id="recordingPreviewModal" class="modal">
        <div class="modal-content" style="max-width:90vw;max-height:90vh;">
            <button class="modal-close" onclick="closeRecordingPreview()" aria-label="닫기(Close)">&times;</button>
            <h3 style="margin-top:0;">녹화 중인 영상 미리보기(Recording Preview)</h3>
            <div style="margin:1rem 0;">
                <video id="previewVideo" controls style="width:100%;max-height:60vh;background:#000;border-radius:8px;"></video>
            </div>
            <div style="display:flex;gap:0.5rem;align-items:center;justify-content:center;flex-wrap:wrap;margin:1rem 0;">
                <label style="display:flex;align-items:center;gap:6px;">
                    재생 속도(Playback Speed):
                    <select id="playbackSpeed" onchange="changePlaybackSpeed(this.value)" style="padding:0.4rem;border-radius:6px;border:1px solid #e6e6e6;">
                        <option value="0.25">0.25x (슬로우)</option>
                        <option value="0.5">0.5x (슬로우)</option>
                        <option value="0.75">0.75x</option>
                        <option value="1.0" selected>1.0x (일반)</option>
                        <option value="1.25">1.25x</option>
                        <option value="1.5">1.5x</option>
                        <option value="2.0">2.0x (빠름)</option>
                    </select>
                </label>
            </div>
            <div style="font-size:0.85rem;color:#666;margin:0.5rem 0;text-align:center;">
                녹화를 재개하려면 닫기 버튼을 누르고 일시 정지 버튼을 다시 누르세요.
            </div>
            <div class="modal-footer" style="display:flex;gap:0.5rem;justify-content:center;margin-top:1rem;">
                <button class="modal-action" onclick="closeRecordingPreview()">닫기(Close)</button>
            </div>
        </div>
    </div>

    <script async src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.12.6/dist/ffmpeg.min.js"></script>
    <script src="script.js"></script>
</body>

</html>
</body>

</html>